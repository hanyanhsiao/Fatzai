<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Member Area</title>
    <!-- 引入CSS -->
    <link rel="stylesheet" href="./css/common/all.css" />
    <link rel="stylesheet" href="./css/common/common.css">
    <link rel="stylesheet" href="./css/member.css" />
    <link rel="stylesheet" href="./css/rwd.css">
    <!-- 引入AOS滑入套件 -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <!--引入font-awesome icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css"
        integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!--引入font-lord icon -->
    <script src="https://cdn.lordicon.com/ritcuqlt.js"></script>
</head>

<body>
    <header class="header"> </header>
    <main>
        <!-- 會員專區標題 -->
        <div class="Member_Area">
            <!-- 背景文字 -->
            <h1>Member Area</h1>
            <!-- 標題文字 -->
            <div class="Member_Area_title">
                <p>會 員 專 區</p>
            </div>
        </div>
        <div class="Member_Area_wrapper">
            <aside class="Member_Area_aside">
                <div class="openMenu">

                    <span>選單</span>
                    <lord-icon class="openMenu_arrow" src="https://cdn.lordicon.com/rvuqcvqy.json" trigger="loop"
                        delay="500" colors="primary:#dc9f58,secondary:#b4b4b4" style="width:30px;height:30px">
                    </lord-icon>
                </div>
                <ul class="Member_Area_menu">
                    <li class="tablinks" onclick="changeSet(event, 'myAccount')" id="defaultOpen">我的帳戶</li>
                    <li class="tablinks" onclick="changeSet(event, 'personal')" id="personal_tab">修改個人資訊</li>
                    <li class="tablinks" onclick="changeSet(event, 'order')" id="order_tab">訂單查詢</li>
                    <li class="tablinks" onclick="changeSet(event, 'coupon')" id="coupon_tab">我的優惠券</li>
                    <li class="tablinks" onclick="changeSet(event, 'favoritelist')" id="favoritelist_tab">
                        <div class="aside_favorite">
                            收藏清單
                            <lord-icon src="https://cdn.lordicon.com/pnhskdva.json" trigger="loop" delay="1000"
                                colors="primary:#dc9f58" style="width:28px;height:28px">
                            </lord-icon>
                        </div>

                    </li>
                </ul>
            </aside>
            <section class="tabcontent" id="myAccount">
                <!-- 右側上半部會員資訊 -->
                <div class="Member_information">
                    <div class="personal_inf">
                        <div style="display: inline-block;">歡迎回來，<p class="customer_name">Trump</p>
                        </div>
                        <button class="signOut">登出</button>
                    </div>
                    <ul class="shopping_inf">
                        <li class="total_spent item">
                            <span class="text">總累計消費金額</span>
                            <span class="value"><span class="money_tag" data-amount="">NT$210</span></span>
                        </li>
                        <li class="total_bonus_points item">
                            <span class="text">可用紅利點數</span>
                            <span class="value">540</span>
                            <span class="text">點</span>
                        </li>
                        <li class="total_coupons item">
                            <span class="text">專屬優惠券</span>
                            <a href="./member.html?memberArea=coupon_tab" class="value">0</a>
                            <span class=" text">張</span>
                        </li>
                    </ul>
                </div>
                <!-- 右側下半部近期訂單 -->
                <h1 class="recent_orders_title">近期訂單</h1>
                <div class="recent_orders">
                    <div class="order">
                        <ul class="order_title">
                            <li>訂單編號</li>
                            <li>訂單日期</li>
                            <li>總金額</li>
                            <li>運送方式</li>
                            <li>付款狀態</li>
                            <li>訂單狀態</li>

                        </ul>
                        <ul class="order_content">
                            <li class="order_number"><a href="./member.html?memberArea=order_tab">#OR2661060</a>
                            </li>
                            <li>2023-01-26</li>
                            <li>NT$660</li>
                            <li>宅配</li>
                            <li>已收到款項</li>
                            <li>已出貨</li>
                        </ul>

                    </div>

                    <div class="order">
                        <ul class="order_title">
                            <li>訂單編號</li>
                            <li>訂單日期</li>
                            <li>總金額</li>
                            <li>運送方式</li>
                            <li>付款狀態</li>
                            <li>訂單狀態</li>

                        </ul>
                        <ul class="order_content">
                            <li class="order_number"><a href="./member.html?memberArea=order_tab">#OR2661060</a>
                            </li>
                            <li>2022-11-26</li>
                            <li>NT$1090</li>
                            <li>門市自取</li>
                            <li>已收到款項</li>
                            <li>已成立</li>
                        </ul>

                    </div>

                    <div class="order">
                        <ul class="order_title">
                            <li>訂單編號</li>
                            <li>訂單日期</li>
                            <li>總金額</li>
                            <li>運送方式</li>
                            <li>付款狀態</li>
                            <li>訂單狀態</li>

                        </ul>
                        <ul class="order_content">
                            <li class="order_number"><a href="./member.html?memberArea=order_tab">#OR2661060</a>
                            </li>
                            <li>2022-11-26</li>
                            <li>NT$660</li>
                            <li>宅配</li>
                            <li>已收到款項</li>
                            <li>已出貨</li>
                        </ul>

                    </div>

                </div>
            </section>
            <section class="tabcontent" id="personal">修改個人資訊</section>
            <section class="tabcontent" id="order">訂單查詢</section>
            <section class="tabcontent" id="coupon">我的優惠券</section>
            <section class="tabcontent" id="favoritelist">
                <div class="favorite_block">
                    <!-- <ul class="favorite_list">
                        <li class="img"><a href="./item.html"><img src="" alt=""></a></li>
                        <li class="favorite_inf">
                            <div class="item_name">商品名稱</div>
                            <div class="item_id">規格</div>
                            <div class="dollars">價錢</div>
                        </li>
                        <li class="favorite_button">
                            <button class="add_cart">
                                <p>加入購物車</p>
                                <lord-icon clas="car_icon" src="https://cdn.lordicon.com/slkvcfos.json" trigger="loop"
                                    delay="1000" colors="primary:#dc9f58,secondary:#dc9f58"
                                    style="width:30px;height:30px">
                                </lord-icon>
                            </button>
                            <div class="delete"><i class="fa-solid fa-trash-can"></i></div>
                        </li>
                    </ul> -->
                </div>
            </section>

        </div>
        <!--手機才有的遮罩-->
        <div id="common_mask"></div>
    </main>
    <footer class="footer"> </footer>

    <!-- javascript -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.lordicon.com/ritcuqlt.js"></script>
    <script src="./js/common.js"></script>
    <script>
        //預設開啟"我的帳戶"那頁
        $(function () {
            document.getElementById("defaultOpen").click();

            let Parameters = new URLSearchParams(window.location.search);
            if (Parameters.has("memberArea")) {
                let tabname = Parameters.get("memberArea");
                document.getElementById(tabname).click();
                console.log(tabname);

            } else {
                document.getElementById("defaultOpen").click();
            }
        })

        //電腦版側邊選單切換
        function changeSet(event, TabName) {
            // console.log("DDD");
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(TabName).style.display = "block";
            // console.log(event.currentTarget.className);

            event.currentTarget.className += " active";
        }

        //手機板上方選單切換
        $('.openMenu').click(function () {
            $(this).toggleClass('active');

            if ($(this).hasClass('active')) {
                $('.Member_Area_menu').slideDown();
            } else {
                $('.Member_Area_menu').slideUp();

            }
        })

        //點擊登出
        $('.signOut').click(function () {
            confirm("確定要登出嗎?")
        })

        //顯示收藏商品資訊及圖片
        function get_favorite_items() {
            let favorite_items = JSON.parse(localStorage.getItem("favorite"));
            // console.log(favorite_items);

            if (favorite_items) {
                let list_html = "";

                favorite_items.forEach(function (item, i) {
                    // console.log(item);
                    list_html += `
                    <ul class="favorite_list">
                        <li class="img"><a href="./item.html"><img src="${get_img(item.item_id)}" alt=""></a></li>
                        <li class="favorite_inf">
                            <div class="item_name">${item.name}</div>
                            <div class="item_id">${item.item_id}</div>
                            <div class="cash">
                                <p>$&nbsp;</p>
                                <div class="dollars">${item.dollars}</div>
                            </div>
                        </li>
                        <li class="favorite_button">
                            <button class="add_cart">
                                <p>加入購物車</p>
                                <lord-icon clas="car_icon" src="https://cdn.lordicon.com/slkvcfos.json" trigger="loop"
                                    delay="1000" colors="primary:#dc9f58,secondary:#dc9f58"
                                    style="width:30px;height:30px">
                                </lord-icon>
                            </button>
                            <div class="delete"><i class="fa-solid fa-trash-can"></i></div>
                        </li>
                    </ul>
                `;
                })

                $('.favorite_block').html(list_html);
            }
        };

        get_favorite_items();

        //移除收藏商品
        $(function () {
            $('.favorite_list .delete').click(function () {
                if (confirm("確定要移除收藏商品嗎?")) {
                    //移除整條ul
                    $(this).closest('ul').remove("ul");
                    //取出item_id
                    let target_item = $(this).closest('li').prev('.favorite_inf').find('.item_id').html();
                    console.log(target_item);


                    //2 移除localstorage
                    let favorite = JSON.parse(localStorage.getItem("favorite"));
                    //不相同的要回存
                    let updated_favorite = favorite.filter(function (item, i) {
                        return target_item != item.item_id;
                    });
                    // 回存至 localStorage
                    localStorage.setItem("favorite", JSON.stringify(updated_favorite));
                }
            })
        })

        //收藏商品加入購物車並淡出移除
        $(function () {
            $('.add_cart').click(function (e) {
                alert("商品已加入購物車")
                //加入購物車新增資料至 localStorage
                //取出ul
                let target_item_ul = $(this).closest('ul');

                let name = target_item_ul.find('.item_name').html();
                let item_id = target_item_ul.find('.item_id').html();
                let dollars = target_item_ul.find('.dollars').html();
                let num = 1;
                let total = dollars * num;

                let item = {
                    "name": name,
                    "item_id": item_id,
                    "dollars": dollars,
                    "num": num,
                    "total": total
                };
                // console.log(item);
                addCar(item);

                //1移除畫面
                target_item_ul.addClass('fade_out');

                setTimeout(function () {
                    target_item_ul.remove()
                }, 500);

                //2 移除favorite的localstorage
                let favorite = JSON.parse(localStorage.getItem("favorite"));
                //不相同的要回存
                let updated_favorite = favorite.filter(function (item, i) {
                    return item_id != item.item_id;
                });
                // 回存至 localStorage
                localStorage.setItem("favorite", JSON.stringify(updated_favorite));
            })

        })

    </script>
</body>

</html>